on:
  workflow_call:
    inputs:
      runner_type:
        description: Action Runner type
        default: ubuntu-latest
        required: false
        type: string
      tf_vars:
        description: Terraform variables
        default: ""
        required: false
        type: string
      environment:
        description: Terraform environment
        required: true
        type: string

jobs:
  terraform:
    name: "Terraform pull request"
    runs-on: ${{ inputs.runner_type }}
    environment: ${{ inputs.environment }}

    steps:
      - uses: actions/checkout@v2

      - name: Inputs
        run: echo ${{ toJson(inputs) }}

      - name: GitHub Context
        run: echo ${{ toJson(github) }}

      - uses: actions/github-script@v5.0.0
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const tf_vars = "${{ inputs.tf_vars }}"
            const info = ${{ toJson(github) }}
            const response = await octokit.request('GET /repositories/{repository_id}/environments/{environment_name}/secrets/{secret_name}', {
              repository_id: info.repository.id,
              environment_name: ${{ inputs.environment }},
              secret_name: 'secret_name'
            })

      - name: GitHub Env Vars
        run: echo ${GITHUB_ENV}
